{
  "attributes": {
    "dataSource.vendor": "GitHub",
    "dataSource.name": "GitHub Audit",
    "dataSource.category": "audit",
    "dataSource.technology": "source_control",
    "source": "github_audit"
  },
  
  "patterns": {
    "timestamp": "\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z",
    "ip_address": "\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}",
    "username": "[a-zA-Z0-9._-]+",
    "action": "[a-zA-Z0-9._-]+",
    "outcome": "(success|failure)",
    "quoted_string": "\"[^\"]*\"",
    "field_value": "[^\\s]+"
  },
  
  "formats": [
    {
      "id": "github_audit_event",
      "format": "$timestamp$ github.audit actor=$quoted_string{name=actor}$ org=$quoted_string{name=org}$ repository=$quoted_string{name=repository}$ action=$quoted_string{name=action}$ outcome=$quoted_string{name=outcome}$ description=$quoted_string{name=description}$ ip=$ip_address{name=source_ip}$",
      "attributes": {
        "dataSource.app": "GitHub Audit Events",
        "class_uid": 8001,
        "class_name": "DevOps Activity",
        "category_uid": 8,
        "category_name": "System Activity",
        "type_uid": 800101,
        "activity_id": 1,
        "activity_name": "Repository Activity",
        "severity_id": 1
      },
      "rewrites": [
        {
          "input": "timestamp",
          "output": "time",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "actor",
          "output": "user.name",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "source_ip",
          "output": "src_endpoint.ip",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "org",
          "output": "metadata.tenant_uid",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "repository",
          "output": "resource.name",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "action",
          "output": "activity_name",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "outcome",
          "output": "status",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "description",
          "output": "message",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "outcome",
          "output": "status_id",
          "match": "success",
          "replace": "1"
        },
        {
          "input": "outcome",
          "output": "status_id",
          "match": "failure",
          "replace": "2"
        },
        {
          "input": "outcome",
          "output": "severity_id",
          "match": "success",
          "replace": "1"
        },
        {
          "input": "outcome",
          "output": "severity_id",
          "match": "failure",
          "replace": "3"
        },
        {
          "input": "action",
          "output": "activity_id",
          "match": "repo\\.(create|delete)",
          "replace": "1"
        },
        {
          "input": "action",
          "output": "activity_id",
          "match": "branch\\.",
          "replace": "2"
        },
        {
          "input": "action",
          "output": "activity_id",
          "match": "(push|commit)",
          "replace": "3"
        },
        {
          "input": "actor",
          "output": "observables",
          "match": ".*",
          "replace": "[{\"name\":\"user\",\"type\":\"User\",\"value\":\"$0\"},{\"name\":\"src_ip\",\"type\":\"IP Address\",\"value\":\"${source_ip}\"}]"
        }
      ],
      "halt": true
    }
  ]
}